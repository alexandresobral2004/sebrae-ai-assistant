<!DOCTYPE html>
<html lang="pt-BR">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Sebrae AI Assistant</title>

    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Estilos -->
    <link rel="stylesheet" href="/static/design-tokens.css">
    <link rel="stylesheet" href="/static/copilot-style.css">

    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: 'Inter', 'Segoe UI', -apple-system, system-ui, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px 0;
      }

      .register-container {
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        width: 100%;
        max-width: 600px;
        padding: 48px;
        margin: 20px;
      }

      .logo-section {
        text-align: center;
        margin-bottom: 32px;
      }

      .logo-section h1 {
        margin: 16px 0 8px 0;
        font-size: 28px;
        font-weight: 700;
        color: var(--copilot-primary, #0F6CBD);
      }

      .logo-section p {
        margin: 0;
        color: var(--text-secondary, #605E5C);
        font-size: 14px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--text-primary, #242424);
        font-size: 14px;
      }

      .form-group label .required {
        color: #D13438;
      }

      .form-input,
      .form-select {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #E1E1E1;
        border-radius: 8px;
        font-size: 14px;
        font-family: inherit;
        transition: all 0.2s;
        box-sizing: border-box;
      }

      .form-input:focus,
      .form-select:focus {
        outline: none;
        border-color: var(--copilot-primary, #0F6CBD);
        box-shadow: 0 0 0 3px rgba(15, 108, 189, 0.1);
      }

      .btn-register {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #006EC7, #0F6CBD);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 8px;
      }

      .btn-register:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(15, 108, 189, 0.3);
      }

      .btn-register:active {
        transform: translateY(0);
      }

      .divider {
        display: flex;
        align-items: center;
        margin: 32px 0;
        color: var(--text-tertiary, #8A8886);
        font-size: 14px;
      }

      .divider::before,
      .divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background: #E1E1E1;
      }

      .divider span {
        padding: 0 16px;
      }

      .btn-google {
        width: 100%;
        padding: 12px;
        background: white;
        border: 1px solid #E1E1E1;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        transition: all 0.2s;
        color: var(--text-primary, #242424);
      }

      .btn-google:hover {
        background: #F5F5F5;
        border-color: #0F6CBD;
      }

      .btn-google img {
        width: 20px;
        height: 20px;
      }

      .switch-mode {
        text-align: center;
        margin-top: 24px;
        font-size: 14px;
        color: var(--text-secondary, #605E5C);
      }

      .switch-mode a {
        color: var(--copilot-primary, #0F6CBD);
        text-decoration: none;
        font-weight: 600;
      }

      .switch-mode a:hover {
        text-decoration: underline;
      }

      .error-message {
        background: #FDE7E9;
        color: #D13438;
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        display: none;
      }

      .error-message.show {
        display: block;
      }

      .success-message {
        background: #DFF6DD;
        color: #107C10;
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        display: none;
      }

      .success-message.show {
        display: block;
      }

      .password-hint {
        font-size: 12px;
        color: var(--text-tertiary, #8A8886);
        margin-top: 4px;
      }

      @media (max-width: 768px) {
        .form-row {
          grid-template-columns: 1fr;
        }

        .register-container {
          padding: 32px 24px;
        }
      }

    </style>
  </head>

  <body>
    <div class="register-container">
      <div class="logo-section">
        <h1>游 Sebrae AI</h1>
        <p>Crie sua conta gratuitamente</p>
      </div>

      <div id="errorMessage" class="error-message"></div>
      <div id="successMessage" class="success-message"></div>

      <button class="btn-google" id="googleRegisterBtn">
        <svg width="20" height="20" viewBox="0 0 20 20">
          <path fill="#4285F4"
            d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z" />
          <path fill="#34A853"
            d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z" />
          <path fill="#FBBC05"
            d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z" />
          <path fill="#EA4335"
            d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z" />
        </svg>
        Cadastrar com Google
      </button>

      <div class="divider">
        <span>ou preencha o formul치rio</span>
      </div>

      <form id="registerForm">
        <div class="form-row">
          <div class="form-group">
            <label for="nome">Nome completo <span class="required">*</span></label>
            <input type="text" id="nome" class="form-input" placeholder="Jo칚o Silva" required>
          </div>

          <div class="form-group">
            <label for="email">Email <span class="required">*</span></label>
            <input type="email" id="email" class="form-input" placeholder="seu@email.com" required>
          </div>
        </div>

        <div class="form-group">
          <label for="password">Senha <span class="required">*</span></label>
          <input type="password" id="password" class="form-input" placeholder="M칤nimo 6 caracteres" required
            minlength="6">
          <div class="password-hint">M칤nimo 6 caracteres</div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="empresa">Empresa</label>
            <input type="text" id="empresa" class="form-input" placeholder="Nome da empresa">
          </div>

          <div class="form-group">
            <label for="cargo">Cargo</label>
            <input type="text" id="cargo" class="form-input" placeholder="Seu cargo">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="telefone">Telefone</label>
            <input type="tel" id="telefone" class="form-input" placeholder="(11) 99999-9999">
          </div>

          <div class="form-group">
            <label for="cpf">CPF</label>
            <input type="text" id="cpf" class="form-input" placeholder="000.000.000-00">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="cidade">Cidade</label>
            <input type="text" id="cidade" class="form-input" placeholder="S칚o Paulo">
          </div>

          <div class="form-group">
            <label for="estado">Estado</label>
            <select id="estado" class="form-select">
              <option value="">Selecione...</option>
              <option value="AC">Acre</option>
              <option value="AL">Alagoas</option>
              <option value="AP">Amap치</option>
              <option value="AM">Amazonas</option>
              <option value="BA">Bahia</option>
              <option value="CE">Cear치</option>
              <option value="DF">Distrito Federal</option>
              <option value="ES">Esp칤rito Santo</option>
              <option value="GO">Goi치s</option>
              <option value="MA">Maranh칚o</option>
              <option value="MT">Mato Grosso</option>
              <option value="MS">Mato Grosso do Sul</option>
              <option value="MG">Minas Gerais</option>
              <option value="PA">Par치</option>
              <option value="PB">Para칤ba</option>
              <option value="PR">Paran치</option>
              <option value="PE">Pernambuco</option>
              <option value="PI">Piau칤</option>
              <option value="RJ">Rio de Janeiro</option>
              <option value="RN">Rio Grande do Norte</option>
              <option value="RS">Rio Grande do Sul</option>
              <option value="RO">Rond칪nia</option>
              <option value="RR">Roraima</option>
              <option value="SC">Santa Catarina</option>
              <option value="SP">S칚o Paulo</option>
              <option value="SE">Sergipe</option>
              <option value="TO">Tocantins</option>
            </select>
          </div>
        </div>

        <button type="submit" class="btn-register">Criar conta</button>
      </form>

      <div class="switch-mode">
        J치 tem uma conta? <a href="/login.html">Fazer login</a>
      </div>
    </div>

    <script>
      // Verifica se j치 est치 logado
      const token = localStorage.getItem('token');
      if (token) {
        window.location.href = '/chat.html';
      }

      // Cadastro com Google
      document.getElementById('googleRegisterBtn').addEventListener('click', () => {
        window.location.href = '/api/auth/google/login';
      });

      // Cadastro com formul치rio
      document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = {
          nome: document.getElementById('nome').value,
          email: document.getElementById('email').value,
          password: document.getElementById('password').value,
          empresa: document.getElementById('empresa').value || null,
          cargo: document.getElementById('cargo').value || null,
          telefone: document.getElementById('telefone').value || null,
          cpf: document.getElementById('cpf').value || null,
          cidade: document.getElementById('cidade').value || null,
          estado: document.getElementById('estado').value || null
        };

        hideError();

        try {
          const response = await fetch('/api/auth/register', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
          });

          const data = await response.json();

          if (response.ok) {
            localStorage.setItem('token', data.access_token);
            localStorage.setItem('user', JSON.stringify(data.user));

            showSuccess('Conta criada com sucesso! Redirecionando...');

            setTimeout(() => {
              window.location.href = '/chat.html';
            }, 1500);
          } else {
            showError(data.detail || 'Erro ao criar conta');
          }
        } catch (error) {
          showError('Erro ao conectar com o servidor');
        }
      });

      // M치scaras de input
      document.getElementById('telefone').addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 11) value = value.slice(0, 11);

        if (value.length > 6) {
          value = value.replace(/^(\d{2})(\d{5})(\d{0,4}).*/, '($1) $2-$3');
        } else if (value.length > 2) {
          value = value.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
        } else if (value.length > 0) {
          value = value.replace(/^(\d*)/, '($1');
        }

        e.target.value = value;
      });

      document.getElementById('cpf').addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 11) value = value.slice(0, 11);

        if (value.length > 9) {
          value = value.replace(/^(\d{3})(\d{3})(\d{3})(\d{0,2}).*/, '$1.$2.$3-$4');
        } else if (value.length > 6) {
          value = value.replace(/^(\d{3})(\d{3})(\d{0,3})/, '$1.$2.$3');
        } else if (value.length > 3) {
          value = value.replace(/^(\d{3})(\d{0,3})/, '$1.$2');
        }

        e.target.value = value;
      });

      // Fun칞칫es auxiliares
      function showError(message) {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = message;
        errorDiv.classList.add('show');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      function hideError() {
        document.getElementById('errorMessage').classList.remove('show');
      }

      function showSuccess(message) {
        const successDiv = document.getElementById('successMessage');
        successDiv.textContent = message;
        successDiv.classList.add('show');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    </script>
  </body>

</html>
