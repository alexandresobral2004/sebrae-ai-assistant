<!DOCTYPE html>
<html lang="pt-BR">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Sebrae AI Assistant</title>

    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Estilos -->
    <link rel="stylesheet" href="/static/design-tokens.css">
    <link rel="stylesheet" href="/static/copilot-style.css">

    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: 'Inter', 'Segoe UI', -apple-system, system-ui, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .login-container {
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        width: 100%;
        max-width: 440px;
        padding: 48px;
        margin: 20px;
      }

      .logo-section {
        text-align: center;
        margin-bottom: 32px;
      }

      .logo-section h1 {
        margin: 16px 0 8px 0;
        font-size: 28px;
        font-weight: 700;
        color: var(--copilot-primary, #0F6CBD);
      }

      .logo-section p {
        margin: 0;
        color: var(--text-secondary, #605E5C);
        font-size: 14px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--text-primary, #242424);
        font-size: 14px;
      }

      .form-input {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #E1E1E1;
        border-radius: 8px;
        font-size: 14px;
        font-family: inherit;
        transition: all 0.2s;
        box-sizing: border-box;
      }

      .form-input:focus {
        outline: none;
        border-color: var(--copilot-primary, #0F6CBD);
        box-shadow: 0 0 0 3px rgba(15, 108, 189, 0.1);
      }

      .btn-login {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #006EC7, #0F6CBD);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 8px;
      }

      .btn-login:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(15, 108, 189, 0.3);
      }

      .btn-login:active {
        transform: translateY(0);
      }

      .divider {
        display: flex;
        align-items: center;
        margin: 32px 0;
        color: var(--text-tertiary, #8A8886);
        font-size: 14px;
      }

      .divider::before,
      .divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background: #E1E1E1;
      }

      .divider span {
        padding: 0 16px;
      }

      .btn-google {
        width: 100%;
        padding: 12px;
        background: white;
        border: 1px solid #E1E1E1;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        transition: all 0.2s;
        color: var(--text-primary, #242424);
      }

      .btn-google:hover {
        background: #F5F5F5;
        border-color: #0F6CBD;
      }

      .btn-google img {
        width: 20px;
        height: 20px;
      }

      .switch-mode {
        text-align: center;
        margin-top: 24px;
        font-size: 14px;
        color: var(--text-secondary, #605E5C);
      }

      .switch-mode a {
        color: var(--copilot-primary, #0F6CBD);
        text-decoration: none;
        font-weight: 600;
      }

      .switch-mode a:hover {
        text-decoration: underline;
      }

      .error-message {
        background: #FDE7E9;
        color: #D13438;
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        display: none;
      }

      .error-message.show {
        display: block;
      }

      .success-message {
        background: #DFF6DD;
        color: #107C10;
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        display: none;
      }

      .success-message.show {
        display: block;
      }

      .forgot-password {
        text-align: right;
        margin-top: 8px;
      }

      .forgot-password a {
        color: var(--copilot-primary, #0F6CBD);
        text-decoration: none;
        font-size: 13px;
      }

      .forgot-password a:hover {
        text-decoration: underline;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #0F6CBD;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }

    </style>
  </head>

  <body>
    <div class="login-container">
      <div class="logo-section">
        <h1>ðŸš€ Sebrae AI</h1>
        <p>Assistente Inteligente de Consultoria</p>
      </div>

      <div id="errorMessage" class="error-message"></div>
      <div id="successMessage" class="success-message"></div>

      <form id="loginForm">
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" class="form-input" placeholder="seu@email.com" required>
        </div>

        <div class="form-group">
          <label for="password">Senha</label>
          <input type="password" id="password" class="form-input" placeholder="Digite sua senha" required>
        </div>

        <div class="forgot-password">
          <a href="#" id="forgotPasswordLink">Esqueceu a senha?</a>
        </div>

        <button type="submit" class="btn-login">Entrar</button>
      </form>

      <div class="divider">
        <span>ou</span>
      </div>

      <button class="btn-google" id="googleLoginBtn">
        <svg width="20" height="20" viewBox="0 0 20 20">
          <path fill="#4285F4"
            d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z" />
          <path fill="#34A853"
            d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z" />
          <path fill="#FBBC05"
            d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z" />
          <path fill="#EA4335"
            d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z" />
        </svg>
        Continuar com Google
      </button>

      <div class="switch-mode">
        NÃ£o tem uma conta? <a href="/register.html">Cadastre-se</a>
      </div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Entrando...</p>
      </div>
    </div>

    <script>
      // Verifica se jÃ¡ estÃ¡ logado
      const token = localStorage.getItem('token');
      if (token) {
        window.location.href = '/chat.html';
      }

      // Captura token do URL (retorno do Google)
      const urlParams = new URLSearchParams(window.location.search);
      const urlToken = urlParams.get('token');

      if (urlToken) {
        localStorage.setItem('token', urlToken);
        showSuccess('Login com Google realizado com sucesso!');
        setTimeout(() => {
          window.location.href = '/chat.html';
        }, 1500);
      }

      // Captura erro do URL
      const error = urlParams.get('error');
      if (error) {
        showError('Erro ao fazer login com Google: ' + error);
      }

      // Login com email e senha
      document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        showLoading(true);
        hideError();

        try {
          const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, password })
          });

          const data = await response.json();

          if (response.ok) {
            localStorage.setItem('token', data.access_token);
            localStorage.setItem('user', JSON.stringify(data.user));

            showSuccess('Login realizado com sucesso!');

            setTimeout(() => {
              window.location.href = '/chat.html';
            }, 1000);
          } else {
            showError(data.detail || 'Email ou senha incorretos');
          }
        } catch (error) {
          showError('Erro ao conectar com o servidor');
        } finally {
          showLoading(false);
        }
      });

      // Login com Google
      document.getElementById('googleLoginBtn').addEventListener('click', () => {
        window.location.href = '/api/auth/google/login';
      });

      // Esqueci a senha
      document.getElementById('forgotPasswordLink').addEventListener('click', (e) => {
        e.preventDefault();
        alert('Funcionalidade em desenvolvimento. Entre em contato com o administrador.');
      });

      // FunÃ§Ãµes auxiliares
      function showError(message) {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = message;
        errorDiv.classList.add('show');
      }

      function hideError() {
        document.getElementById('errorMessage').classList.remove('show');
      }

      function showSuccess(message) {
        const successDiv = document.getElementById('successMessage');
        successDiv.textContent = message;
        successDiv.classList.add('show');
      }

      function showLoading(show) {
        document.getElementById('loading').style.display = show ? 'block' : 'none';
        document.getElementById('loginForm').style.display = show ? 'none' : 'block';
        document.querySelector('.btn-google').style.display = show ? 'none' : 'flex';
      }
    </script>
  </body>

</html>
